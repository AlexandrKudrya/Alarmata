# Iteration 3.3: Advanced Statistics + Insights

**Итерация:** 3 (Циклы сна + Аналитика)
**Срок:** 6-8 дней
**Статус:** Не начата

## Цель

Полноценная аналитика сна: графики, инсайты, тренды. Пользователь понимает свои паттерны и видит прогресс.

## Задачи

### Sleep Tracking
- [ ] `SleepSessionEntity` — запись сессий сна
- [ ] Расчёт: bedtime → wake time = длительность
- [ ] Ручной ввод bedtime (когда лёг) — опциональный экран
- [ ] Автоматика: если включил Bedtime Mode (Iteration 4) → записываем

### Графики (Vico или MPAndroidChart)
- [ ] Bar chart: длительность сна за неделю/месяц
- [ ] Line chart: скользящее среднее времени сна
- [ ] Scatter plot: регулярность (время отбоя vs пробуждения)
- [ ] Heatmap: качество сна по дням недели
- [ ] Переключатель: неделя / месяц / 3 месяца

### Insights Engine
- [ ] SQL-агрегации для анализа трендов
- [ ] Генерация инсайтов:
  - "Оптимальная длительность сна для тебя: 7.5ч"
  - "По понедельникам просыпаешься сложнее на 30%"
  - "Стрик: 5 дней стабильного режима"
  - "Среднее время решения заданий уменьшилось на 15%"
- [ ] Показ инсайтов на экране статистики (карточки)

### Напоминание "Пора спать"
- [ ] Notification за N часов до будильника (настраивается)
- [ ] Default: за 8 часов
- [ ] Deeplink в Bedtime Mode (когда будет реализован)

### Export
- [ ] Базовый CSV export статистики
- [ ] Выбор диапазона дат
- [ ] Share через Intent

## SleepSession Schema

```kotlin
@Entity(tableName = "sleep_sessions")
data class SleepSessionEntity(
    @PrimaryKey(autoGenerate = true) val id: Long = 0,
    val bedtime: Long,
    val wakeTime: Long,
    val sleepDuration: Long,  // минуты
    val quality: Int?,        // 1-5
    val notes: String?
)
```

## Критерии завершения

- Графики отображаются корректно и красиво
- Инсайты генерируются на основе реальных данных
- Напоминание "Пора спать" приходит вовремя
- CSV export работает

## Зависимости

- MVP 1.5 (базовая статистика, AlarmLog)
- IT-2.3 (расширенное логирование)
