# MVP 1.4: Task System — Math Challenge

**Итерация:** 1 (MVP)
**Срок:** 4-6 дней
**Статус:** Не начата

## Цель

Создать движок заданий и реализовать математические задачи. Будильник нельзя отключить без решения всех примеров.

## Задачи

- [ ] Архитектура Task Engine:
  - Interface `Task` с методами `generate()`, `validate()`, `getCurrentProgress()`, `reset()`
  - `TaskData` — данные задания (вопрос, подсказка, метаданные)
  - `TaskProgress` — прогресс (current, total, mistakes)
  - `TaskFactory` — создание заданий по типу и сложности
- [ ] Реализация `MathTask`:
  - Easy: однозначные числа, +/-
  - Medium: двузначные числа, +/-/*
  - Hard: трёхзначные, смешанные операции
  - 3-5 примеров подряд (настраивается)
  - Валидация ответа
  - Счётчик попыток и ошибок
- [ ] UI для ActiveAlarmScreen — секция задания:
  - Показ текущего примера крупным шрифтом
  - TextField для ввода ответа (NumericKeyboard)
  - Кнопка "Проверить"
  - Анимация: зелёная/красная вспышка при правильном/неправильном ответе
  - Progress bar: "3/5 примеров решено"
  - Блокировка кнопки "Отключить" пока не решены все примеры
- [ ] Настройка задания при создании будильника:
  - Выбор типа задания (пока только Math)
  - Выбор сложности (Easy / Medium / Hard)
- [ ] Логирование: запись результатов в `AlarmLog`

## Task Interface

```kotlin
interface Task {
    fun generate(): TaskData
    fun validate(answer: String): Boolean
    fun getCurrentProgress(): TaskProgress
    fun reset()
}

data class TaskData(
    val question: String,
    val hint: String? = null,
    val metadata: Map<String, Any> = emptyMap()
)

data class TaskProgress(
    val current: Int,
    val total: Int,
    val mistakes: Int
)
```

## Примеры заданий по сложности

| Сложность | Пример | Диапазон |
|-----------|--------|----------|
| Easy | 7 + 5 = ? | 1-9, только +/- |
| Medium | 34 * 7 = ? | 10-99, +/-/* |
| Hard | (47 * 3) + 28 = ? | 10-999, смешанные |

## Критерии завершения

- Математические задания генерируются без повторов
- Валидация ответов работает корректно
- Нельзя отключить будильник без решения всех примеров
- Progress bar отображает прогресс
- Feedback при правильном/неправильном ответе
- Настройка типа и сложности при создании будильника

## Зависимости

- MVP 1.3 (будильник срабатывает, ActiveAlarmActivity существует)

## Риски

- Генерация слишком сложных/простых примеров — тестировать диапазоны
- UX: ввод ответа сразу после пробуждения должен быть максимально удобным
